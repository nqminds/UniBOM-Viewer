import { fileURLToPath } from "url";
import fs from "fs";
import path from "node:path";
import { dirname } from "path";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const listOfCpes = [];

/**
 * Extracts CPE values from components.
 *
 *
 * @example
 * getCpes("../input/sbom.json");
 *
 * @param {string} pathToSbom - Path to SBOM file
 * @returns {string[]} Array of CPE strings.
 */
export async function getCpes(pathToSbom) {
  // read the CycloneDx SBOM JSON file
  const sbomData = fs.readFileSync(path.resolve(__dirname, pathToSbom));
  const sbomJson = JSON.parse(sbomData);

  // extract CPE values from components
  sbomJson.components.forEach((component) => {
    if (component.cpe) {
      const cpe = component.cpe.replace("cpe:/a:", "cpe:2.3:a:");
      listOfCpes.push(cpe);
    }
  });
  return listOfCpes;
}
