import axios from "axios";

const baseUrl = "https://services.nvd.nist.gov/rest/json/cves/2.0?cpeName=";

/**
 * Retrieves a list of all CVEs which are weaknesses for the given CPE
 * currently uses Axios as it converts data to json format for better readability.
 *
 * @param {string} cpe - CPE string which is given from SBOM
 * @param {string} [apiKey] - API key which increases API rate limit
 * @returns {Array} - List of CVEs
 */
export default async function getCves(cpe, apiKey) {
  const config = {
    headers: {
      apiKey,
    },
  };
  const url = buildCveAddr(cpe);

  const response = await axios(url, config);
  if (response.status === 200) {
    return response.data.vulnerabilities;
  } else {
    // TODO: Soft fail
    return [];
  }
}

function buildCveAddr(cpe) {
  return baseUrl + cpe.replace("cpe:/", "cpe:2.3:");
}
