/* eslint-disable jsdoc/require-jsdoc */
/* eslint-disable jsdoc/require-description */
import sbom from "./input/sbom.json" assert { type: "json" };
import memoryCweCodes from "./input/memory-cwe-codes.json" assert { type: "json" };
import config from "config";

import getCves from "./src/get-cves.mjs";
import formatCveList from "./src/format-cve-list.mjs";
import findMemoryVulnerabilities from "./src/find-memory-vulnerabilities.mjs";

const apiKey = config.get("apiKey");

const { components } = sbom;
const { ids: memoryVulnerableCwes } = memoryCweCodes;

const cvePromiseList = await Promise.all(
  components.map(({ cpe }) => getCves(cpe, apiKey))
);
const cveList = formatCveList(cvePromiseList);

// eslint-disable-next-line no-unused-vars
const memoryVulnerabilies = findMemoryVulnerabilities(
  cveList,
  memoryVulnerableCwes
);
